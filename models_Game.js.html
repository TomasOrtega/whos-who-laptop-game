<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: models/Game.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: models/Game.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// server/models/Game.js

const fs = require('fs');
const path = require('path');

/**
 * A two-player "Who's Who?" game.
 * Tomas has a board loaded from client/images/tomas.
 * Nora has a board loaded from client/images/nora.
 * Tomas’s mystery is chosen from Nora’s board; Nora’s from Tomas’s board.
 */
class Game {
  // Private fields (Node.js 14+ with --harmony-private-fields or Node 16+)
  #tomasBoard;
  #noraBoard;
  #tomasMystery;
  #noraMystery;

  constructor() {
    // Build both boards
    this.#tomasBoard = this.#buildBoard('tomas');
    this.#noraBoard = this.#buildBoard('nora');

    // Assign each player's mystery from the *opposite* board
    this.#tomasMystery = this.#pickMystery(this.#noraBoard);
    this.#noraMystery = this.#pickMystery(this.#tomasBoard);
  }

  /**
   * Builds a board by reading image files from client/images/&lt;playerFolder>.
   * @param {string} playerFolder - "tomas" or "nora"
   * @returns {Array} an array of character objects
   */
  #buildBoard(playerFolder) {
    // Example: /.../client/images/tomas
    const imagesDir = path.join(__dirname, '..', '..', 'client', 'images', playerFolder);

    let files;
    try {
      // Read all images in the given subfolder
      files = fs.readdirSync(imagesDir);
    } catch (err) {
      // If the folder doesn't exist or is unreadable, return an empty board
      console.warn(`[Game] Warning: Could not read folder "${imagesDir}":`, err);
      return [];
    }

    // Filter only typical image files, then sort them
    files = files
      .filter(file => /\.(png|jpe?g|gif|svg)$/i.test(file))
      .sort((a, b) => a.localeCompare(b));

    // Map them into board items
    return files.map((filename, index) => ({
      id: index + 1,
      name: path.basename(filename, path.extname(filename)),
      image: `/images/${playerFolder}/${filename}`,
      isGrayedOut: false
    }));
  }

  /**
   * Randomly picks one character from the given board. Returns null if the board is empty.
   * @param {Array} board - an array of character objects
   */
  #pickMystery(board) {
    if (!board || board.length === 0) {
      return null;
    }
    const randomIndex = Math.floor(Math.random() * board.length);
    return board[randomIndex];
  }

  /**
   * Returns { board, mysteryCharacter } for the requested player.
   * @param {string} playerName - "Tomas" or "Nora"
   */
  getPlayerState(playerName) {
    switch (playerName) {
      case 'Tomas':
        return {
          board: this.#tomasBoard,
          mysteryCharacter: this.#tomasMystery
        };
      case 'Nora':
        return {
          board: this.#noraBoard,
          mysteryCharacter: this.#noraMystery
        };
      default:
        throw new Error(`Unknown player "${playerName}". Must be "Tomas" or "Nora".`);
    }
  }

  /**
   * Toggles the isGrayedOut flag on a character in the player's own board.
   * e.g., if "Tomas" clicks ID=2, we flip isGrayedOut for ID=2 on Tomas's board.
   * @param {string} playerName - "Tomas" or "Nora"
   * @param {number} characterId - ID of the character on that player's board
   */
  handleMove(playerName, characterId) {
    let board;
    if (playerName === 'Tomas') {
      board = this.#tomasBoard;
    } else if (playerName === 'Nora') {
      board = this.#noraBoard;
    } else {
      throw new Error(`Invalid player name: "${playerName}"`);
    }

    const charObj = board.find(c => c.id === characterId);
    if (!charObj) {
      throw new Error(`Character ${characterId} not found on ${playerName}'s board.`);
    }

    // Flip the isGrayedOut flag
    charObj.isGrayedOut = !charObj.isGrayedOut;
  }
}

module.exports = Game;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Game.html">Game</a></li></ul><h3>Global</h3><ul><li><a href="global.html#createGame">createGame</a></li><li><a href="global.html#currentGame">currentGame</a></li><li><a href="global.html#getFirstLocalIPv4Address">getFirstLocalIPv4Address</a></li><li><a href="global.html#getPlayerState">getPlayerState</a></li><li><a href="global.html#logMessage">logMessage</a></li><li><a href="global.html#makeMove">makeMove</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Sun May 25 2025 18:25:29 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
